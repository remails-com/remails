{
  "db_name": "PostgreSQL",
  "query": "\n            UPDATE organizations\n            SET\n                remaining_rate_limit = CASE\n                    WHEN rate_limit_reset < now()\n                    THEN $2\n                    ELSE CASE\n                        WHEN remaining_rate_limit - 1 > 0\n                        THEN remaining_rate_limit - 1\n                        ELSE 0\n                    END\n                END,\n                rate_limit_reset = CASE\n                    WHEN rate_limit_reset < now()\n                    THEN now() + '1 min'\n                    ELSE rate_limit_reset\n                END\n            FROM (\n                SELECT c.*, o.id AS org_id\n                FROM smtp_credentials c\n                JOIN streams s ON s.id = c.stream_id\n                JOIN projects p ON p.id = s.project_id\n                JOIN organizations o ON o.id = p.organization_id\n                WHERE username = $1\n            ) AS cred_and_org_id\n            WHERE organizations.id = cred_and_org_id.org_id\n            RETURNING remaining_rate_limit, \n                cred_and_org_id.id, cred_and_org_id.description, cred_and_org_id.username, cred_and_org_id.password_hash,\n                cred_and_org_id.stream_id, cred_and_org_id.created_at, cred_and_org_id.updated_at\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "remaining_rate_limit",
        "type_info": "Int8"
      },
      {
        "ordinal": 1,
        "name": "id",
        "type_info": "Uuid"
      },
      {
        "ordinal": 2,
        "name": "description",
        "type_info": "Varchar"
      },
      {
        "ordinal": 3,
        "name": "username",
        "type_info": "Varchar"
      },
      {
        "ordinal": 4,
        "name": "password_hash",
        "type_info": "Varchar"
      },
      {
        "ordinal": 5,
        "name": "stream_id",
        "type_info": "Uuid"
      },
      {
        "ordinal": 6,
        "name": "created_at",
        "type_info": "Timestamptz"
      },
      {
        "ordinal": 7,
        "name": "updated_at",
        "type_info": "Timestamptz"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "Int8"
      ]
    },
    "nullable": [
      false,
      false,
      false,
      false,
      false,
      false,
      false,
      false
    ]
  },
  "hash": "fbcda234ae0a783b5cceb67d51a7fa99d6010211a99c84c3f02df4a4f53720db"
}
